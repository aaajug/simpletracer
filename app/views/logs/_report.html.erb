<style type="text/css">
  .input-group.date {
    width: 7rem;
    display: inline-block;
  }
</style>

<h3><%= @info[0].fullname %></h3>
<h6>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-phone-vibrate" viewBox="0 0 16 16">
    <path d="M10 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h4zM6 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H6z"/>
    <path d="M8 12a1 1 0 1 0 0-2 1 1 0 0 0 0 2zM1.599 4.058a.5.5 0 0 1 .208.676A6.967 6.967 0 0 0 1 8c0 1.18.292 2.292.807 3.266a.5.5 0 0 1-.884.468A7.968 7.968 0 0 1 0 8c0-1.347.334-2.619.923-3.734a.5.5 0 0 1 .676-.208zm12.802 0a.5.5 0 0 1 .676.208A7.967 7.967 0 0 1 16 8a7.967 7.967 0 0 1-.923 3.734.5.5 0 0 1-.884-.468A6.967 6.967 0 0 0 15 8c0-1.18-.292-2.292-.807-3.266a.5.5 0 0 1 .208-.676zM3.057 5.534a.5.5 0 0 1 .284.648A4.986 4.986 0 0 0 3 8c0 .642.12 1.255.34 1.818a.5.5 0 1 1-.93.364A5.986 5.986 0 0 1 2 8c0-.769.145-1.505.41-2.182a.5.5 0 0 1 .647-.284zm9.886 0a.5.5 0 0 1 .648.284C13.855 6.495 14 7.231 14 8c0 .769-.145 1.505-.41 2.182a.5.5 0 0 1-.93-.364C12.88 9.255 13 8.642 13 8c0-.642-.12-1.255-.34-1.818a.5.5 0 0 1 .283-.648z"/>
  </svg>&nbsp;&nbsp;<%= @info[0].mobile %><br>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16">
    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383-4.758 2.855L15 11.114v-5.73zm-.034 6.878L9.271 8.82 8 9.583 6.728 8.82l-5.694 3.44A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.739zM1 11.114l4.758-2.876L1 5.383v5.73z"/>
  </svg>&nbsp;&nbsp;<%= @email%>
</h6>

<br>
<br>
<div class="grid mt-4 mb-2">
  <div class="row">
    <div class="col-4">
<%= form_with url: "/manager/trace" , local:false , method: :post,id: "withRangeDates" do |form| %>
    <%= hidden_field_tag(:email, @email) %>
    <div id="startdatepicker" class="input-group date" data-date-format="yyyy/mm/dd" name="startdate">
        <%= hidden_field_tag(:startdate, true) %>
        <% if @confirmedcase or !@startdate.nil? %>
            <input class="form-control" type="text" value="<%= @startdate %>" style="width: 7rem;flex: none !important;" />
        <% else %>
            <input class="form-control" type="text" placeholder="start date" style="width: 7rem;flex: none !important;" />
        <% end %>
        <span class="input-group-addon"></span>
     </div>
     <div id="enddatepicker" class="input-group date" data-date-format="yyyy/mm/dd" name="enddate">
        <%= hidden_field_tag(:enddate, true) %>
        <% if @confirmedcase or !@enddate.nil? %>
            <input class="form-control" type="text" value="<%= @enddate %>" style="width: 7rem;flex: none !important;" />
        <% else %>
            <input class="form-control" type="text" placeholder="end date" style="width: 7rem;flex: none !important;" />
        <% end %>
        <span class="input-group-addon"></span>
     </div>
     <%= hidden_field_tag(:casedate, false) %>
    <div  class="input-group date">
          <input class="form-control" type="submit" name="commit" id="setDateRange" data-disable-with="view logs" value="view logs" style="width: 7rem;flex: none !important;background-color: #ffc107;border-color: #ffc107;" />
          <span class="input-group-addon"></span>
       </div >
<% end %>
</div>

<div class="col-1 d-flex justify-content-center mb-5">
  <span class="text-muted">or</span>
</div>

    <div class="col-7">
      <div id="casedatepicker" class="input-group date" data-date-format="yyyy/mm/dd" name="casedate" style="right: 0">
          <% if @confirmedcase %>
                  <input class="form-control" type="text" value="<%= @enddate %>" style="width: 14rem;flex: none !important;" />
              <% else %>
                  <input class="form-control" type="text" placeholder="date of reported case" style="width: 14rem;flex: none !important;"/>
              <% end %>
          <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
      </div>
    </div>
  </div>
</div>

<h5>Establishments visited</h5>
<div class="log card bg-white mb-5">
        <div class="log card-body">
<table class="table table-borderless table-hover">
  <thead>
    <tr>
      <th>Date of Visit</th>
      <th>Time of Visit</th>
      <th>Establishment Visited</th>
    </tr>
  </thead>

  <tbody>
    <% @ownLogs.each do |log| %>
      <tr>
        <td><%= log.created_at.strftime("%d %b %Y") %></td>
        <td><%= log.created_at.strftime("%I:%M %p") %></td>
        <td><%= log.estname %></td>
      </tr>
    <% end %>
  </tbody>
</table>
</div>
</div>

<% if @confirmedcase %>
<h5>Other possible contacts</h5>
<div class="log card text-white bg-white">
  <div class="log card-body">
    <table class="table table-borderless table-hover">
      <thead>
        <tr>
          <th>Establishment Visited</th>
          <th>Date of Visit</th>
          <th>Time of Visit</th>
          <th>Name</th>
          <th>Mobile No.</th>
          <th>Email</th>
        </tr>
      </thead>

      <tbody>
        <% @otherContacts.each do |log| %>
          <tr>
            <td><%= log.estname %></td>
            <td><%= log.created_at.strftime("%d %b %Y") %></td>
            <td><%= log.created_at.strftime("%I:%M %p") %></td>
            <td><%= log.fullname %></td>
            <td><%= log.mobile %></td>
            <td><%= log.email %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
<% end %>

<script type="text/javascript">
    $(document).ready(function() {
      
      // console.log("page loaded " + $("#startdatepicker input").val() + " -- dates");
      // if( $("#startdatepicker input").val() != '') {
      //   $("#startdatepicker").datepicker('update', new Date($("#startdatepicker").val()));
        
      //   console.log($("#startdatepicker").datepicker('getDate'));
      // } 
    });

    $("#casedatepicker").datepicker({ 
        todayHighlight: true,
        autoclose: true
    });

    $("#startdatepicker").datepicker({ 
        todayHighlight: true,
        autoclose: true
    })

    <% if !@startdate.nil? %>
      $('#startdatepicker').datepicker('update', new Date('<%= @startdate %>'));
    <% end %>

    $("#enddatepicker").datepicker({ 
        todayHighlight: true,
        autoclose: true
    });

    <% if !@enddate.nil? %>
      $('#enddatepicker').datepicker('update', new Date('<%= @enddate %>'));
    <% end %>

    $("#casedatepicker").on('changeDate', function (casedate) {
        console.log("date picked: " + new Date(casedate.format(0,'yyyy/mm/dd')));
        var t = new Date(casedate.format(0,'yyyy/mm/dd'));
        var start = new Date(t);
        start.setDate(start.getDate() - 5);

        console.log("new date: " + new Date(start));

        $("#startdatepicker").datepicker('update', new Date(start));        
        $("#enddatepicker").datepicker('update', casedate.date);    

        $("#casedate").val(true);
        $("#setDateRange").click();
    });
</script>